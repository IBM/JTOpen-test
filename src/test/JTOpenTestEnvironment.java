///////////////////////////////////////////////////////////////////////////////
//
// JTOpen (IBM Toolbox for Java - OSS version)
//
// Filename:  JTOpenTestEnvironment
//
// The source code contained herein is licensed under the IBM Public License
// Version 1.0, which has been approved by the Open Source Initiative.
// Copyright (C) 1997-2023 International Business Machines Corporation and
// others.  All rights reserved.
//
///////////////////////////////////////////////////////////////////////////////
// 
// Provides details about the test environment
// 
///////////////////////////////////////////////////////////////////////////////


package test;

import java.io.FileInputStream;
import java.io.IOException;
import java.util.Properties;

public class JTOpenTestEnvironment  {

  public static String testcaseHomeDirectory = null; 
  public final static String DEFAULT_JTOPEN_TEST_DIR="/home/jdbctest"; 
  static String cygwinBase = "C:\\etlocalinst\\cygwin";
  
  public static boolean isWindows = false; 
  public static boolean isLinux   = false; 
  public static boolean isAIX     = false; 
  public static boolean isOS400   = false;
  public static String osVersion = "" ; 
  public static Properties systemsProperties = new Properties();

  static {
    testcaseHomeDirectory = System.getenv("JTOPEN_TEST_DIR");
    if (testcaseHomeDirectory == null) {
      testcaseHomeDirectory = DEFAULT_JTOPEN_TEST_DIR;
      System.out
          .println("Warning:  JTOPEN_TEST_DIR environment variable not set: defaulting to " + testcaseHomeDirectory);
    }
    String operatingSystem = System.getProperty("os.name"); 
    osVersion = operatingSystem+" "+System.getProperty("os.version"); 
    isWindows = operatingSystem.indexOf("Windows") >= 0;
    if (operatingSystem.indexOf("OS/400") >= 0) {
      isOS400 = true; 
    } else if (isWindows) {
      cygwinBase = System.getenv("CYGWIN_HOME");
      if (cygwinBase == null) {
        System.out.println("Warning:  CYGWIN_HOME is not set for a Windows system");
        cygwinBase = "CYGWIN_HOME_NOT_SET";
      }
    } else if (operatingSystem.indexOf("Linux") >= 0) {
      isLinux = true;
    } else if (operatingSystem.indexOf("AIX") >= 0) {    
      isAIX = true;                                 
    }                                              

    loadSystemsIni(); 
  }
  
  public static void loadSystemsIni() { 
    systemsProperties = new Properties();
    String filename = testcaseHomeDirectory+"/ini/systems.ini";
    FileInputStream fileInputStream;
    try {
      fileInputStream = new FileInputStream(filename);
    systemsProperties.load(fileInputStream);
    fileInputStream.close();
    } catch (IOException e) {
      System.out.println("Warning:  error processing ini/systems.ini"); 
      e.printStackTrace(System.out);
    }

    
  }
  
  public static String getDefaultServerDomain() throws Exception { 
    String defaultServerDomain = systemsProperties.getProperty("DEFAULT_SERVER_DOMAIN"); 
    if (defaultServerDomain == null) { 
      // Retry 
      loadSystemsIni(); 
      defaultServerDomain = systemsProperties.getProperty("DEFAULT_SERVER_DOMAIN"); 
      if (defaultServerDomain == null) { 
        throw new Exception("Unable to find DEFAULT_SERVER_DOMAIN in ini/systems.ini: Please define"); 
      }
    }
    return defaultServerDomain; 
  }

  public static String getDefaultClientDomain() throws Exception { 
    String defaultClientDomain = systemsProperties.getProperty("DEFAULT_CLIENT_DOMAIN"); 
    if (defaultClientDomain == null) { 
      // Retry 
      loadSystemsIni(); 
      defaultClientDomain = systemsProperties.getProperty("DEFAULT_CLIENT_DOMAIN"); 
      if (defaultClientDomain == null) { 
        throw new Exception("Unable to find DEFAULT_CLIENT_DOMAIN in ini/systems.ini: Please define"); 
      }
    }
    return defaultClientDomain; 
  }


}
